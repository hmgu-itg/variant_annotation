Bootstrap: docker
From: ubuntu:18.04

%environment
	TZ=Europe/Berlin
	PATH=$PATH:/usr/local/bin:/usr/local/bin/variant_annotation:/opt/locuszoom/bin:/opt/plink
	export PATH
	LC_ALL=C
	export LC_ALL
	PYTHONPATH=/usr/local/bin/variant_annotation/python:$PYTHONPATH
	export PYTHONPATH
%post
	apt update
	ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

	apt install -y locales gnupg software-properties-common bc
	apt-add-repository ppa:ubuntu-elisp/ppa
	apt update
	sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen
	locale-gen
	dpkg-reconfigure --frontend=noninteractive locales

        apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
        add-apt-repository 'deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran35/'

	DEBIAN_FRONTEND="noninteractive" apt install -y software-properties-common build-essential git python3 python3-pip wget tabix moreutils python2.7 r-base lftp
	DEBIAN_FRONTEND="noninteractive" apt install -y curl libgtk2.0-0 libx11-xcb-dev libxtst6 libxss1 libgconf-2-4 libnss3 libasound2 xvfb xauth firefox-geckodriver
	
	pip3 install numpy matplotlib scipy pandas scikit-learn
	pip3 install --upgrade setuptools 
	pip3 install argparse jinja2 pandas selenium psutil plotly requests kaleido

	cd /usr/local/bin
	git clone --branch dev --single-branch https://github.com/hmgu-itg/variant_annotation

	apt-get install -y zlib1g zlib1g-dev python-dev emacs-snapshot
	cd /usr/local/bin
	wget http://ftp.gnu.org/gnu/datamash/datamash-1.8.tar.gz && tar -xzf datamash-1.8.tar.gz && cd datamash-1.8 && ./configure && make && make check && make install
	apt-get install -y git
	CREATIONDATE=`date`

%runscript
	echo "This container was created: $CREATIONDATE"

%labels
	Author Andrei Barysenka
	Version v0.1

%help
	https://github.com/hmgu-itg/variant_annotation.
